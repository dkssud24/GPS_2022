library(data.table)
library(dplyr)
library(lmtest)
d <- fread('/BiO/hae/phase2/phase3/phase4/phase5/00_middle_project/88_GPS_LDPRED2/GPS/TG/00_reported_GWAS_TG_pred_med_hm3_r3_amb_vali_pred_inf_v2.csv')
#d <- fread('/BiO/Hyein/our_hm3_GPS/result_TG/vali_fam_pred_inf_TG.txt')
st_pred_inf <- scale(d$pred_inf)
no_ALT <- qnorm((rank(d$ALT_30620,na.last="keep")-0.5)/sum(!is.na(d$ALT_30620)))
names(no_ALT) <- c("no_ALT")
names(st_pred_inf) <- c("st_pred_inf")
d <- cbind(d,no_ALT,st_pred_inf)
#c <- lm( d$X30870_0_0_TG ~ age+sex.x+pc1+pc2+pc3+pc4+pc5+pc6+pc7+pc8+pc9+pc10+st_pred_inf , data= d)
#c <- lm( d$no_TG ~ age+sex.x+pc1+pc2+pc3+pc4+pc5+pc6+pc7+pc8+pc9+pc10+st_pred_inf , data= d)
#c <- lm( d$X30870_0_0_TG ~ age+sex+pc1+pc2+pc3+pc4+pc5+pc6+pc7+pc8+pc9+pc10+st_pred_inf , data= d)
c <- lm( no_TG ~ age+sex+pc1+pc2+pc3+pc4+pc5+pc6+pc7+pc8+pc9+pc10+st_pred_inf , data= d)
l <- data.frame(residuals(c))
names(l) <- c("res")
l2 <- abs(l)
names(l2) <- c("abs_res")
l3 <- data.frame(l$res*l$res)
names(l3) <- c("res_2")
d <- cbind(d,l,l2,l3)
aetd <- d %>% mutate(tile10=ntile(st_pred_inf,10))
aetd2 <- aggregate(abs_res ~ tile10, aetd,mean)
plot(aetd2$tile10,aetd2$abs_res,type="o",xlab=c("decile of GPS"),ylab=c("Mean of residuals"),ylim=c(0.7,0.8))
fligner.test(res,tile10,data=aetd)
